\documentclass[12pt,3p]{article}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
\usepackage[margin=0.75in]{geometry}
\usepackage{amsmath}
\usepackage{mathtools}
\usepackage{enumitem}
\usepackage{physics}

\usepackage[round,numbers]{natbib}
\usepackage[colorlinks = false]{hyperref}

\begin{document}

\title{Augmented Lagrangian Contact of Compressible Hyperelastic Cube \\
	\large{} }
\author{Ida Ang}
\date{\vspace{-5ex}}
\maketitle

\section{Problem Definition}
This document is based on the original FEniCS hyperelasticity demo, but uses a different formulation. In the original demo, the weak form is not written explicitly and instead the demo uses an energy minimization scheme. 

\subsection{Energy Density Function}
The energy density function for compressible Neo-Hookean materials is: 
\begin{align}\label{EDComp}
W &= \frac{\mu}{2} (I_1 - 3 - 2 \ln J) + \frac{\lambda}{2} (\ln J)^2 
\end{align}
where $\mu$ and $\lambda$ are LamÃ© Parameters and can be defined in terms of the Young's modulus, E, and Poisson's ratio $\nu$
\begin{equation}\label{lame}
\mu = \frac{E}{2 (1 + \nu)} \quad \lambda = \frac{E \nu}{(1+ \nu) (1 - 2 \nu)} 
\end{equation}
The first and third invariant of the deformation:
\begin{equation}\label{invariants}
I_1 = \trace(\mathbf{C}) \quad J = \det(\mathbf{F})  
\end{equation}

\subsection{Equilibrium equation}
The nominal stress tensor is defined as: 
\begin{equation}\label{PW}
P_{iJ} = \pdv{W}{F_{iJ}}
\end{equation}
Use the chain rule to find the expression for the nominal stress tensor using the energy density function: 
\begin{align*} 
\pdv{W}{F_{iJ}} &= \pdv{W}{I_1} \pdv{I_1}{F_{iJ}} + \pdv{W}{I_3} \pdv{I_3}{F_{iJ}} \quad \text{See Proof section} \\
\mathbf{P} &= \frac{\mu}{2} (2 \mathbf{F}) + \bigg[ \frac{\mu}{2} (-\frac{2}{I_3}) + \frac{\lambda}{2} 2 \frac{ \ln J}{J} \bigg] J \mathbf{F}^{-T} \\
		&= \mu \mathbf{F} - \bigg[ \frac{\mu}{I_3} + \lambda \frac{\ln I_3}{I_3} \bigg] J \mathbf{F}^{-T} \\
		&= \mu \mathbf{F} - \mu \mathbf{F}^{-T} + \lambda \ln J  \mathbf{F}^{-T} 
\end{align*}

Rearranging we can obtain the nominal stress tensor, P: 
\begin{equation}\label{P}
\mathbf{P} = \mu (\mathbf{F} - \mathbf{F}^{-T} ) + \lambda \ln J \mathbf{F}^{-T}
\end{equation}


\subsection{Proofs}
Proof of the derivative $\pdv{I_1}{\mathbf{F}}$ in indicial: 
\begin{align*}
\pdv{\trace(\mathbf{F^T} \mathbf{F})}{\mathbf{F}} &= \pdv{F_{kI} F_{kI}}{F_{pQ}} \quad \text{Product Rule}\\ 
									&= \pdv{F_{kI}}{F_{pQ}} F_{kI} + F_{kI} \pdv{F_{kI}}{F_{pQ}} \\
									&= \delta_{kp} \delta_{IQ} F_{kI} + F_{kI} \delta_{kp} \delta_{IQ} \\
									&= F_{pQ} + F_{pQ} = 2 F_{pQ}
\end{align*}
Therefore, we have the following relationship: 
\begin{equation}\label{proof1}
\pdv{\trace(\mathbf{F^T} \mathbf{F})}{\mathbf{F}} = 2 \mathbf{F}
\end{equation}
Relationship for $\pdv{I_3}{\mathbf{F}}$
\begin{align*}
\pdv{\det \mathbf{F} }{\mathbf{F}} = \det \mathbf{F} \mathbf{F^{-T}} = \mathbf{J} \mathbf{F^{-T}}
\end{align*}

\section{Strong and Weak Forms}
\begin{equation}\label{EqmEq}
\pdv{P_{iJ}}{X_J} + b_i = 0 
\end{equation}
Take Eq. \ref{EqmEq} and multiply by a test function 
\begin{align*}
\pdv{P_{iJ}}{X_J} \mathbf{e_i} \cdot v_j \mathbf{e_j} &= - b_i \mathbf{e_i} \cdot v_j \mathbf{e_j} \\
\pdv{P_{iJ}}{X_J} v_j \delta_{ij} &= - b_i v_j \delta_{ij} \\
\pdv{P_{iJ}}{X_J} v_i &= - b_i v_i \quad \text{Integrate over domain} \\
\int_{\Omega_o} \pdv{P_{iJ}}{X_J} v_i dV &= - \int_{\Omega_o} b_i v_i dV \quad \text{Use integration by parts } f'g = (fg)' - f g' \\
\int_{\Omega_o} (P_{iJ} v_i)_{,J} dV - \int_{\Omega_o} P_{iJ} v_{i,J} dV &= - \int_{\Omega_o} b_i v_i dV \quad \text{Use divergence theorem} \\
\int_{\partial \Omega_o} P_{iJ} N_J v_i dS - \int_{\Omega_o} P_{iJ} v_{i,J} dV &= - \int_{\Omega_o} b_i v_i dV \quad \text{Recognize traction } P_{iJ} N_J = T_i\\
\int_{\partial \Omega_o} T_i v_i dS - \int_{\Omega_o} P_{iJ} v_{i,J} dV &= - \int_{\Omega_o} b_i v_i dV \quad \text{rearrange} \\
\int_{\Omega_o} P_{iJ} v_{i,J} dV &= \int_{\Omega_o} b_i v_i dV + \int_{\partial \Omega_o} T_i v_i dS 
\end{align*}
Rewrite in direct notation to obtain weak form: 
\begin{equation}\label{wForm}
 \int_{\Omega_o} P : \text{Grad}(v) dV = \int_{\Omega_o} b v dV + \int_{\partial \Omega_o} T v dS
\end{equation}

\section{Contact}
The rigid indenter with a spherical surface can be approximated by a parobolic equation instead of explicitly modeled and meshed. Consider the indenter radius, R, to be sufficiently large with respect to the contact region characteristic size (R $>>$ a). This relationship, R $>>$ a, allows the spherical surface to be approximated by a parabola.
\begin{align}\label{Indenter}
\begin{split}
h(x,z) &= - h_o + \frac{1}{2 R}(x^2 + z^2) \quad \text{about origin} \\
h(x, z) &= - h_o + \frac{1}{2 R}\big[ (x - 0.5)^2 + (z-0.5)^2 \big] \quad \text{about point } (0.5, 0.5)
\end{split}
\end{align}
where the gap is defined as 
\begin{align*}
g_N = u_N - h
\end{align*}
Where there are several cases 
\begin{equation}
\begin{aligned}
g_N & \geq 0 \\
p_N & \leq 0 \quad \text { on } \Gamma_{c} \\
p_N g_N &=0
\end{aligned}
\end{equation}
The definition of the MacKauley bracket:
\begin{align}\label{MacKauley}
\begin{split}
<x> &= \frac{x + |x|}{2} \\
<x> &= 
\begin{dcases}
    0 \text{ for } x \leq 0, \\
    x \text{ for } x > 0
\end{dcases}
\end{split}
\end{align}

\subsection{Penalty Approach}
Adding a penalty term to the energy, $\Pi$.
\begin{align}\label{631}
\begin{split}
\Pi_N^P = \frac{1}{2} \int_{\Gamma_c} k_{pen} (g_{N})^2 dA \quad \text{where } k_{pen} > 0 
\end{split}
\end{align}
Take the variation of Eq. \ref{631}, this holds for pure stick. This is the addition to the weak form: 
\begin{align*}
C_N^P &= k_{pen} \int_{\Gamma_c} \big( g_{N} \delta g_{N} \big) dA \\
C_N^P &=  k_{pen} \int_{\Gamma_c} \big( g_{N} \delta u_{N} \big) dA
\end{align*}


\subsubsection{Incorporating into weak form}
\begin{align*}
k_{pen} \int_{\partial \Omega_0} g_N\delta u_N \, dS +\int_{\Omega_0} \mathbf{P} : \text{Grad}(\pmb{\delta} \mathbf{u} ) \, dV - \int_{\Omega_0} \mathbf{B} \cdot \pmb{\delta} \mathbf{u} \, dV - \int_{\partial \Omega_0} \mathbf{T} \cdot \pmb{\delta} \mathbf{u} \, dS  &= 0 \\
 \int_{\Omega_0} \left(C-C^{t}\right) \delta \mu d V-\int_{\Omega_0} \mathbf{J} \cdot \frac{\delta \mu}{\delta X} \Delta t d V - \int_{\partial \Omega_0} i \delta \mu \Delta t d S-\int_{\Omega_0} r \delta \mu \Delta t d V &=0 
 \end{align*}


\subsection{Lagrange Multiplier Method}
Lagrange multiplier to add constraints: 
\begin{align*}
\begin{split}
\Pi_N^{L} = \int_{\Gamma_c} \lambda_N g_{N} dA 
\end{split}
\end{align*}
Take the variation
\begin{align*}
C_N^L &= \int_{\Gamma_c} \big( \delta \lambda_N g_N + \lambda_N \delta g_N \big) dA \\
C_N^L &=  \int_{\Gamma_c} \big( g_N \delta \lambda_N + \lambda_N \delta u_N \big) dA
\end{align*}

\subsubsection{Incorporating into weak form}
\begin{align*}
\int_{\partial \Omega_0} \lambda_N \delta u_N \, dS +\int_{\Omega_0} \mathbf{P} : \text{Grad}(\pmb{\delta} \mathbf{u} ) \, dV - \int_{\Omega_0} \mathbf{B} \cdot \pmb{\delta} \mathbf{u} \, dV - \int_{\partial \Omega_0} \mathbf{T} \cdot \pmb{\delta} \mathbf{u} \, dS  &= 0 \\
 \int_{\Omega_0} \left(C-C^{t}\right) \delta \mu d V-\int_{\Omega_0} \mathbf{J} \cdot \frac{\delta \mu}{\delta X} \Delta t d V - \int_{\partial \Omega_0} i \delta \mu \Delta t d S-\int_{\Omega_0} r \delta \mu \Delta t d V &=0 \\
 \int_{\partial \Omega_0} g_N \delta \lambda_N dS &= 0 
 \end{align*}


\subsection{Augmented Lagrange Approach}

\subsubsection{Augmented Lagrange Methods: Wriggers}
We introduce the following augmented lagrangian term.
\begin{align*}
\hat{\lambda}_N = \lambda_N + k_{pen} g_N
\end{align*}
Possible contact cases
\begin{equation}
\begin{aligned}
\text { Contact: } & g_N = 0, \quad \lambda_N < 0, \quad \hat{\lambda}_N < 0 \\
\text { No Contact: } & g_N > 0, \quad \lambda_N = 0, \quad \hat{\lambda}_N > 0 \\
\text { Interpenetration: } & g_N < 0, \quad \lambda_N < 0, \quad \hat{\lambda}_N = 0 
\end{aligned}
\end{equation}
where the gap is defined as 
\begin{align*}
g_N = u_N - h
\end{align*}
The main idea of this method is combining the penalty method with Lagrange multiplier methods. The augmented Lagrange functional is introduced for normal contact: 
\begin{align}\label{658}
\Pi_{N}^{AL} = 
\begin{dcases}
    \int_{\Gamma_c} (\lambda_N g_N + \frac{1}{2} \epsilon_N g_N^2) d \Gamma & \text{for } \hat{\lambda}_N \leq 0, \\
    \int_{\Gamma_c} -\frac{1}{2 \epsilon_N} |\lambda_N|^2 d \Gamma               & \text{for } \hat{\lambda}_N > 0
\end{dcases}
\end{align}
where $ \hat{\lambda}_N \leq 0$ indicates that the gap is closed and $\hat{\lambda}_N > 0$ means the gap is open. 
Taking the variation of Eq. \ref{658} gives the following, where we recognize the augmented lagrangian 
\begin{align*}
C_{N}^{AL} &= 
\begin{dcases}
    \int_{\Gamma_c} (\delta \lambda_N g_N + \lambda_N \delta g_N + \epsilon_N g_N \delta g_N) d \Gamma & \text{for } \hat{\lambda}_N \leq 0, \\
    \int_{\Gamma_c} -\frac{1}{\epsilon_N} \lambda_N \delta \lambda_N d \Gamma               & \text{for } \hat{\lambda}_N > 0
\end{dcases} \\
C_{N}^{AL} &= 
\begin{dcases}
    \int_{\Gamma_c} \bigg( \delta \lambda_N g_N + (\lambda_N + \epsilon_N g_N) \delta g_N \bigg) d \Gamma & \text{for } \hat{\lambda}_N \leq 0, \\
    \int_{\Gamma_c} -\frac{1}{\epsilon_N} \lambda_N \delta \lambda_N d \Gamma               & \text{for } \hat{\lambda}_N > 0
\end{dcases} 
\end{align*}
Final equation for variation: 
\begin{align}\label{659}
C_{N}^{AL} &= 
\begin{dcases}
    \int_{\Gamma_c} \bigg( \delta \lambda_N g_N + \hat{\lambda}_N \delta g_N \bigg) d \Gamma & \text{for } \hat{\lambda}_N \leq 0, \\
    \int_{\Gamma_c} -\frac{1}{\epsilon_N} \lambda_N \delta \lambda_N d \Gamma               & \text{for } \hat{\lambda}_N > 0
\end{dcases}
\end{align}

\subsubsection{Augmented Lagrange: Contact Methods in Finite Element Simulations}
Defined with the Mackauley bracket where p = $\epsilon_N$
\begin{align*}
\Pi_{N}^{AL} = \frac{1}{2 k_{pen}} < - (\lambda_N + k_{pen} g_N) >^2
\end{align*}
If we take the variation of this equation:
\begin{align*}
C_N &= \frac{2}{2 k_{pen}} <- (\lambda_N + k_{pen} g_N)> \delta \lambda_N + \frac{2}{2 k_{pen}} <-(\lambda_N + k_{pen} g_N) > k_{pen} \delta g_N \\
C_N &= \frac{1}{k_{pen}} <- (\lambda_N + k_{pen} g_N)> \delta \lambda_N + <-(\lambda_N + k_{pen} g_N) > \delta g_N
\end{align*}

\subsubsection{Addition into weak form}
The formulation that works is the source which utilizes the Mackauley bracket, with a removal of the Mackauley bracket of the first term. Note that this is the same as placing the Mackauley bracket around $\hat{\lambda}_N$ in the Wriggers formulation: 
\begin{align*}
C_N &= \frac{1}{k_{pen}} \big[- (\lambda_N + k_{pen} g_N) \big] \delta \lambda_N + <-(\lambda_N + k_{pen} g_N) > \delta g_N \\
C_N &= - \frac{1}{k_{pen}} \lambda_N \delta \lambda_N + g_N \delta \lambda_N + <-(\lambda_N + k_{pen} g_N) > \delta g_N \quad \text{define } g_N = u - h(x, z) \\
C_N &= - \frac{1}{k_{pen}} \lambda_N \delta \lambda_N + g_N \delta \lambda_N + < - \hat{\lambda} > \delta u_N 
\end{align*}
The addition of the lagrange multiplier augments the solution space and increases the number of equations in the weak form by 1 equation. 
\begin{align*}
 \int_{\partial \Omega_0} < - \hat{\lambda}_N > \delta u_N \, dS +\int_{\Omega_0} \mathbf{P} : \text{Grad}(\pmb{\delta} \mathbf{u} ) \, dV - \int_{\Omega_0} \mathbf{B} \cdot \pmb{\delta} \mathbf{u} \, dV - \int_{\partial \Omega_0} \mathbf{T} \cdot \pmb{\delta} \mathbf{u} \, dS  &= 0 \\
 \int_{\Omega_0} \left(C-C^{t}\right) \delta \mu d V-\int_{\Omega_0} \mathbf{J} \cdot \frac{\delta \mu}{\delta X} \Delta t d V - \int_{\partial \Omega_0} i \delta \mu \Delta t d S-\int_{\Omega_0} r \delta \mu \Delta t d V &=0 \\
- \frac{1}{k_{pen}} \int_{\partial \Omega_o} \lambda_N \delta \lambda_N \, dS +  \int_{\partial \Omega_o}  g_N \delta \lambda_N \, dS &= 0 
\end{align*}
Without fluid diffusion
\begin{align*}
 \int_{\partial \Omega_o} < - \hat{\lambda} > \pmb{\delta} \mathbf{u} \, dS +\int_{\Omega_o} \mathbf{P} : \text{Grad}(\pmb{\delta} \mathbf{u} ) \, dV - \int_{\Omega_o} \mathbf{B} \cdot \pmb{\delta} \mathbf{u} \, dV - \int_{\partial \Omega_o} \mathbf{T} \cdot \pmb{\delta} \mathbf{u} \, dS  &= 0 \\
- \frac{1}{k_{pen}} \int_{\partial \Omega_o} \lambda \delta \lambda \, dS +  \int_{\partial \Omega_o}  g_N \delta \lambda \, dS &= 0 
\end{align*}

\subsubsection{Question}
Without 
\begin{align*}
\int_{\Omega_0} \mathbf{P} : \pmb{\nabla}_X \, \pmb{\delta} \mathbf{u}  \, dV - \int_{\Omega_0} \mathbf{B} \cdot \pmb{\delta} \mathbf{u} \, dV - \int_{\partial \Omega_0} \mathbf{T} \cdot \pmb{\delta} \mathbf{u} \, dS  &= 0 \\
\int_{\Omega_0} \left(C-C^{t}\right) \delta \mu \, d V - \int_{\Omega_0} \mathbf{J} \cdot \nabla_X \, \delta \mu \, \Delta t \, dV - \int_{\partial \Omega_0} i \, \delta \mu \, \Delta t \, d S - \int_{\Omega_0} r \, \delta \mu \, \Delta t \, dV &=0 
\end{align*}
We introduce the following augmented lagrangian term.
\begin{align*}
\hat{\lambda}_N &= \lambda_N + k_{pen} g_N \\
g_N &=  h - u_N
\end{align*}
First
\begin{align*}
 \int_{\partial \Omega_0} < \hat{\lambda}_N > \delta u_N \, dS -  \int_{\partial \Omega_0} \hat{\lambda}_N  \delta u_N \, dS + \int_{\Omega_0} \mathbf{P} : \pmb{\nabla}_X \, \pmb{\delta} \mathbf{u}  \, dV - \int_{\Omega_0} \mathbf{B} \cdot \pmb{\delta} \mathbf{u} \, dV - \int_{\partial \Omega_0} \mathbf{T} \cdot \pmb{\delta} \mathbf{u} \, dS  &= 0 \\
\int_{\Omega_0} \left(C-C^{t}\right) \delta \mu \, d V - \int_{\Omega_0} \mathbf{J} \cdot \nabla_X \, \delta \mu \, \Delta t \, dV - \int_{\partial \Omega_0} i \, \delta \mu \, \Delta t \, d S - \int_{\Omega_0} r \, \delta \mu \, \Delta t \, dV &=0 \\
- \frac{1}{k_{pen}} \int_{\partial \Omega_o} \lambda_N \delta \lambda \, dS +  \int_{\partial \Omega_o}  g_N \delta \lambda \, dS &= 0 
\end{align*}
Note that this is the full expression
\begin{align*}
 \int_{\partial \Omega_0} < \hat{\lambda}_N > \delta u_N \, dS -  \int_{\partial \Omega_0} \hat{\lambda}_N  \delta u_N \, dS + \int_{\Omega_0} \mathbf{P} : \pmb{\nabla}_X \, \pmb{\delta} \mathbf{u}  \, dV - \int_{\Omega_0} \mathbf{B} \cdot \pmb{\delta} \mathbf{u} \, dV - \int_{\partial \Omega_0} \mathbf{T} \cdot \pmb{\delta} \mathbf{u} \, dS  &= 0 \\
- k_{s1} \int_{\Omega_0}\big(  \nabla_X (\mu - \mu^t ) \cdot \nabla_X \, \delta \mu \big) d V +\int_{\Omega_0} \left(C-C^{t}\right) \delta \mu \, d V - \int_{\Omega_0} \mathbf{J} \cdot \nabla_X \, \delta \mu \, \Delta t \, dV - \int_{\partial \Omega_0} i \, \delta \mu \, \Delta t \, d S - \int_{\Omega_0} r \, \delta \mu \, \Delta t \, dV &=0 \\
-  k_{s2} \int_{\Omega_0} \big(  \nabla_X (\lambda_N - \lambda_N^t ) \cdot \nabla_X \delta \lambda \big) d V - \frac{1}{k_{pen}} \int_{\partial \Omega_o} \lambda_N \delta \lambda \, dS +  \int_{\partial \Omega_o}  g_N \delta \lambda \, dS &= 0 
\end{align*}


\end{document}
